const{GoogleGenerativeAI:GoogleGenerativeAI,HarmCategory:HarmCategory,HarmBlockThreshold:HarmBlockThreshold}=require("@google/generative-ai"),fs=require("fs"),{onRequest:onRequest}=require("firebase-functions/v2/https"),apiKey=process.env.GEMINI_API_KEY,genAIWhoguini=new GoogleGenerativeAI(apiKey),modelChosenWhoguini="gemini-1.5-flash",instructionsWhoguini=fs.readFileSync("prompt-whoguini.txt","utf8"),generationConfigWhoguini={temperature:.7,topP:.95,topK:40,maxOutputTokens:400,responseMimeType:"text/plain"},safetySettingsWhoguini=[{category:HarmCategory.HARM_CATEGORY_HARASSMENT,threshold:HarmBlockThreshold.BLOCK_LOW_AND_ABOVE},{category:HarmCategory.HARM_CATEGORY_HATE_SPEECH,threshold:HarmBlockThreshold.BLOCK_LOW_AND_ABOVE},{category:HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:HarmBlockThreshold.BLOCK_LOW_AND_ABOVE},{category:HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE}],modelWhoguini=genAIWhoguini.getGenerativeModel({model:"gemini-1.5-flash",systemInstruction:instructionsWhoguini,generationConfigWhoguini:generationConfigWhoguini,safetySettingsWhoguini:safetySettingsWhoguini});exports.whoguini=onRequest({cors:!0},(async(e,o)=>{let t=e.query.history;t||(t=[]);const i=modelWhoguini.startChat({history:t});let r=e.query.prompt;r||(r="Who are you and what can you do?");const n=(await i.sendMessage(r)).response.text();o.send(n)}));